



<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>Wallet Login Protocol</title>

    <!-- CSS -->
    <link href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css' rel='stylesheet'>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" rel="stylesheet">
    <link href='../../_static/main.css' rel='stylesheet'>
    <link href='../../_static/style.css' rel='stylesheet'>
    <link href='../../_static/doxygen.css' rel='stylesheet'>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

    <!-- Sphinx search -->
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="searchindex.js"></script>
    <!-- Transifex -->
    <script type="text/javascript">
      window.liveSettings = {
        api_key: "bbf87af0641e4bbf89c98088d48e0449",
      };
    </script>
    <script type="text/javascript" src="http://cdn.transifex.com/live.js"></script>

    <!-- title card -->
    <link  href='../../_static/title-card.css' rel='stylesheet'>
    <script src='../../_static/script.js'></script>
    
    <!-- Sphinx search -->
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Graphene Technical Documentation  documentation"
          href="../../_static/opensearch.xml"/>

    <!-- Meta -->
    <meta content="Graphene Documentation" property="og:site_name">
    <meta content="Graphene Documentation" property="og:title">
    <meta content="website" property="og:type">
    <meta content="Graphene Documentation" name="description">
    <meta content="Graphene Documentation" property="og:description">
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68381245-1', 'auto');
  ga('send', 'pageview');

</script>

 </head>
 <body class='no-literate'>


 <div class='title-area title-card' style='background-image: url(https://bitshares.org/images/bg.jpg)'>
   <div class='in'>
     <div class='headline'>
       <h1>Wallet Login Protocol</h1>
 
     </div>
   </div>
 </div>

 <div class='header'>
   <div class='left navlinks'>
    
        <div class="prev">
         <div class="title">previous</div>
         <span><a href="merchant-protocol.html">Wallet Merchant Protocol</a></span>
        </div>
        <div class="top">
         <div class="title">top</div>
         <span><a class="uplink" href="../../index.html">Contents</a></span>
        </div>
        <div class="next">
         <div class="title">next</div>
         <span><a href="merchant-protocol.html">Wallet Merchant Protocol</a></span>
        </div>

   </div>
 </div>

 <div class='content-root'>
  <!-- menu bar -->
  <div class='menubar'>
   <div class='section'>
    <a href="../..//index.html"><img src="../../_static/grphn-logo.svg" height="48" /></a>

    <a href="../..//bitshares/index.html"><img src="../../_static/bitshares-logo.png" height="48" /></a>

    <a href="../..//muse/index.html"><img src="../../_static/MUSE_logo_transp_v1.png" height="48" /></a>
   </div>
   <div class='menu section'>
    <div id="toc">
      <h3>Table Of Contents</h3>
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../../bitshares/index.html">BitShares 2.0</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../muse/index.html">MUSE</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Integration Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#basic-knowledge">Basic Knowledge</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#use-cases">Use-Cases</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../exchanges/index.html">Exchanges, Bridges, and Gateways</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Merchants</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="index.html#protocols-api">Protocols/API</a><ul class="current">
<li class="toctree-l5 current"><a class="current reference internal" href="">Wallet Login Protocol</a></li>
<li class="toctree-l5"><a class="reference internal" href="merchant-protocol.html">Wallet Merchant Protocol</a></li>
</ul>
</li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html#libraries">Libraries</a><ul class="current">
<li class="toctree-l5 current"><a class="current reference internal" href="">Wallet Login Protocol</a></li>
<li class="toctree-l5"><a class="reference internal" href="merchant-protocol.html">Wallet Merchant Protocol</a></li>
<li class="toctree-l5"><a class="reference internal" href="../libraries/index.html">Supporting Libraries</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../traders/index.html">Traders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../traders/python-binding.html">Python Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../businesses/index.html">Businesses</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../testnet/index.html">Testnets</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../meta/index.html">How to Contribute</a></li>
</ul>

    </div>
   </div>
   <div class="search section">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
   </div>
   <div class='bottom section'>
    <p class="centered">
     <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>
    </p>
   </div>
  </div>
  <div class='content'>
   
  <div class="section" id="wallet-login-protocol">
<h1>Wallet Login Protocol<a class="headerlink" href="#wallet-login-protocol" title="Permalink to this headline">¶</a></h1>
<p>The idea behind the login protocol is to allow another party to verify that you
are are the owner of a particular account. Traditionally login is performed via
a password that sent to the server, but this method is subject to <a class="reference external" href="https://en.wikipedia.org/wiki/Phishing">Phishing
Attacks</a>. Instead of a password,
Graphene uses a cryptographic challenge/response to verify that a user controls
a particular account.</p>
<p>For the purpose of this document, we will assume <a class="reference external" href="https://merchant.org">https://merchant.org</a> is the
service that will be logged into and that <a class="reference external" href="https://wallet.org">https://wallet.org</a> is the wallet
provider that will be assisting the user with their login.</p>
<div class="section" id="step-1-merchant-login-button">
<h2>Step 1 - Merchant Login Button<a class="headerlink" href="#step-1-merchant-login-button" title="Permalink to this headline">¶</a></h2>
<p>The merchant must provide the user with a login button that links to
<code class="docutils literal"><span class="pre">https://wallet.org/login#${args}</span></code> where <cite>${args}`</cite> is a JSON object
containing following information and serialized as described below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
   <span class="s">&quot;onetimekey&quot;</span> <span class="p">:</span> <span class="s">&quot;${SERVER_PUBLIC_KEY}&quot;</span><span class="p">,</span>
   <span class="s">&quot;account&quot;</span>  <span class="p">:</span> <span class="s">&quot;${OPT_ACCOUNT_NAME}&quot;</span><span class="p">,</span>
   <span class="s">&quot;callback&quot;</span> <span class="p">:</span> <span class="s">&quot;https://merchant.org/login_callback&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The merchant server will need to save the <code class="docutils literal"><span class="pre">${SERVER_PRIVATE_KEY}</span></code>
associated with the <code class="docutils literal"><span class="pre">${SERVER_PUBLIC_KEY}</span></code> in the user&#8217;s web session
in order to verify the login.</p>
</div>
<div class="section" id="step-2-compress-your-json-representation">
<h2>Step 2 - Compress your JSON representation<a class="headerlink" href="#step-2-compress-your-json-representation" title="Permalink to this headline">¶</a></h2>
<p>Using <a class="reference external" href="https://github.com/nmrugg/LZMA-JS/">LZMA-JS</a> library to
compress the JSON into a binary array. This will be the most compact
form of the data. After running the compression the example JSON was
reduced to 281 bytes from 579 bytes.</p>
</div>
<div class="section" id="step-3-convert-to-base58">
<h2>Step 3 - Convert to Base58<a class="headerlink" href="#step-3-convert-to-base58" title="Permalink to this headline">¶</a></h2>
<p>Using the <a class="reference external" href="http://cryptocoinjs.com/modules/misc/bs58/">bs58</a> library
encode the compressed data in base58. Base58 is URL friendly and size
efficient. After converting to base58 the string will be 385 characters
which can easily be passed in a URL and easily support much larger
invoices.</p>
</div>
<div class="section" id="step-4-wallet-confirmation">
<h2>Step 4 - Wallet Confirmation<a class="headerlink" href="#step-4-wallet-confirmation" title="Permalink to this headline">¶</a></h2>
<p>When the user loads <code class="docutils literal"><span class="pre">https://wallet.org/login#${args}</span></code> they will be
prompted to confirm the login request by selecting an account that they
wish to login with. If &#8220;account&#8221; was specified in the <code class="docutils literal"><span class="pre">${args}</span></code> then
it will default to that account.</p>
<p>After the account is identified enough keys to authorize a account must
participate in the login process in the following way.</p>
<p>The wallet generates a <code class="docutils literal"><span class="pre">WALLET_ONETIMEKEY</span></code> and derives a <code class="docutils literal"><span class="pre">shared</span> <span class="pre">secret</span></code>
with the <code class="docutils literal"><span class="pre">SERVER_PUBLIC_KEY</span></code> provided by the <code class="docutils literal"><span class="pre">https://merchant.org</span></code> via
<code class="docutils literal"><span class="pre">${args}</span></code>. This shared secret is a provably &#8220;random&#8221; 512 bits of data that is
only known to the wallet at this point in time. The wallet then gathers
signatures on the shared secret from enough keys to authorize the account. In
the simple case this will be a single signature, but in more complex cases
multi-factor authentication may be required.</p>
<p>After gathering all of the signatures the wallet redirects the user to
<code class="docutils literal"><span class="pre">https://merchant.org/login_callback?a=${result}</span></code> where <code class="docutils literal"><span class="pre">result</span></code> is
an encoded JSON object containing the following information:</p>
<div class="highlight-python"><div class="highlight"><pre>{
   &quot;account&quot;: &quot;Graphene Account Name&quot;,
   &quot;server_key&quot;: &quot;${SERVER_PUBLIC_KEY}&quot;,
   &quot;account_key&quot;: &quot;${WALLET_ONETIMEKEY}&quot;,
   &quot;signatures&quot; : [ &quot;SIG1&quot;, &quot;SIG2&quot;, .. ]
}
</pre></div>
</div>
</div>
<div class="section" id="step-5-server-verifies-authority">
<h2>Step 5 - Server Verifies Authority<a class="headerlink" href="#step-5-server-verifies-authority" title="Permalink to this headline">¶</a></h2>
<p>Upon receiving the <code class="docutils literal"><span class="pre">result</span></code> from the wallet, <a class="reference external" href="https://merchant.org">https://merchant.org</a> will lookup
<code class="docutils literal"><span class="pre">{SERVER_PRIVATE_KEY}</span></code> in the user&#8217;s session data and then combine it with
<code class="docutils literal"><span class="pre">{WALLET_ONETIMEKEY}</span></code> to generate the <em>shared secret</em> that was used by the
wallet. Once this shared secret has been recovered, it can be used to recover
the public keys that correspond to the provided signatures.</p>
<p>The last step is to verify that the public keys provided by the
signatures are sufficient to authorize the account given the current
state of the graphene blockchain. This can be achieved using the witness
API call::</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">verify_account_authority</span><span class="p">(</span> <span class="n">account_name_or_id</span><span class="p">,</span> <span class="p">[</span><span class="n">public_keys</span><span class="o">...</span><span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">verify_account_authority</span></code> call will return <code class="docutils literal"><span class="pre">true</span></code> if the provided keys
have sufficient authority to authorize the account, otherwise it will return
<code class="docutils literal"><span class="pre">false</span></code></p>
</div>
</div>


  </div>
 </div>

 <script>var HN=[];HN.factory=function(e){return function(){HN.push([e].concat(Array.prototype.slice.call(arguments,0)))};},HN.on=HN.factory("on"),HN.once=HN.factory("once"),HN.off=HN.factory("off"),HN.emit=HN.factory("emit"),HN.load=function(){var e="hn-button.js";if(document.getElementById(e))return;var t=document.createElement("script");t.id=e,t.src="//hn-button.herokuapp.com/hn-button.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)},HN.load();</script>
 <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
 </body>
</html>